# Ralph Progress Log
Started: 2026-01-30
Feature: AI Auto-Update URLs
Parent Task: 27

## Codebase Patterns
- Tailwind v4 with @tailwindcss/vite plugin (no separate config file)
- Custom colors: sidebar, accent, surface defined in @theme block in index.css
- Custom fonts: font-heading (DM Sans), font-body (IBM Plex Sans)
- Component classes: .nav-link, .btn-primary, .btn-secondary defined in @layer components
- AI/magic features use violet-500 to indigo-600 gradient to differentiate from accent green
- Modal/dialog pattern: fixed overlay with backdrop blur + centered content
- Toast pattern: isLeaving state for exit animation before onHide callback
- Use useLiveQuery from dexie-react-hooks for reactive queries
- All mutations are async functions (not hooks) for easy calling from event handlers

---

## 2026-01-30 - Define URL schema and types
Thread: https://ampcode.com/threads/T-019c0f89-3bbb-77f3-9c1a-2eff164af59a
Task ID: 28
- Added `AutoUpdatePayload` interface to src/types/index.ts
- Interface includes: candidateId (required), interviewId, primary_profile, secondary_profiles, overall_hire_signal, axis_scores, axis_notes, tags
- Reuses existing `Axis` and `HireSignal` types
- **Learnings:** Axis and HireSignal types already defined - use `Partial<Record<Axis, T>>` for sparse axis data
---

## 2026-01-30 - Create URL parser/generator utilities
Thread: https://ampcode.com/threads/T-019c0f8a-3aba-7494-b0bf-faff6f22d8a7
Task ID: 29
- Created `src/utils/autoUpdateUrl.ts` with `parseAutoUpdateUrl()` and `generateAutoUpdateUrl()` functions
- URL format: `{origin}/#/apply?data={base64EncodedJSON}`
- Parser extracts data from hash query params, decodes base64, validates JSON structure
- Validates: candidateId (required), interviewId, primary_profile, secondary_profiles, overall_hire_signal, axis_scores (1-5), axis_notes, tags
- Returns null for malformed URLs, invalid base64, or failed validation
- Generator uses `window.location.origin` for SPA compatibility
- **Learnings:** 
  - Use `new URL()` then parse hash manually for hash-based routing params
  - Use `atob()`/`btoa()` for base64 encoding/decoding in browser
  - Validate axis_scores values are numbers 1-5
---

## 2026-01-30 - Update CandidateSummaryPromptModal with URL template
Thread: https://ampcode.com/threads/T-019c0f8b-e519-730f-bc00-665160a8393e
Task ID: 34
- Added auto-update URL template section to `generateSummaryPrompt()` function
- Imports `generateAutoUpdateUrl` from utils
- Template includes: format explanation, JSON payload fields, instructions, and example URL
- Example uses the actual candidate ID for valid URLs
- Lists all supported fields: primary_profile, secondary_profiles, overall_hire_signal, tags
- **Learnings:**
  - Use `as const` for literal type inference in example payloads
  - `window.location.origin` needs SSR guard (`typeof window !== 'undefined'`)
---

## 2026-01-30 - Update AIPromptModal with URL template
Thread: https://ampcode.com/threads/T-019c0f8d-2bce-70bc-ba77-fc90195bcf0b
Task ID: 33
- Added auto-update URL template section to `generatePrompt()` function in AIPromptModal.tsx
- Imports `generateAutoUpdateUrl` from utils
- Template includes: format explanation, JSON payload fields, instructions, and example URL
- Interview-specific: includes both candidateId and interviewId in payload
- Supports interview-level fields: axis_scores and axis_notes (partial updates allowed)
- Example uses actual candidate_id and interview.id for valid URLs
- **Learnings:**
  - Interview has `candidate_id` (snake_case) for accessing the parent candidate
  - For interview updates, both candidateId and interviewId are required in the payload
---

## 2026-01-30 - Add /apply route handler
Thread: https://ampcode.com/threads/T-019c0f8e-aa54-76dd-8802-2d706c884f0b
Task ID: 30
- Created `src/pages/ApplyRoute.tsx` component to handle auto-update URLs
- Added `/apply` route in `src/App.tsx`
- Parses URL using `parseAutoUpdateUrl()`, redirects to candidate detail with payload in route state
- Invalid URLs show error toast and redirect to home
- Added `variant` prop to Toast component for error styling (red icon)
- Exports `AutoUpdateRouteState` interface for CandidateDetail to consume
- **Learnings:**
  - Use `useLocation()` + `window.location.href` to get full URL including hash
  - Pass state via `navigate()` second argument: `{ state: { ... }, replace: true }`
  - Toast variant pattern: add optional `variant` prop with 'success' | 'error'
---
